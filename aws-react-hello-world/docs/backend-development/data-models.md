# Data Models

This document describes the data models used in the AWS Starter Project, focusing on the project management system with task tracking capabilities.

## Data Model Overview

Our MongoDB database consists of five main collections, each representing a core entity in our project management system. The collections are designed to support project-centric task management with team collaboration features.

### Entity Relationship Diagram

```
+----------------+       +-------------------+       +----------------+
|     USERS      |       | PROJECT_MEMBERS   |       |    PROJECTS    |
+----------------+       +-------------------+       +----------------+
| id (PK)        |       | id (PK)           |       | id (PK)        |
| username       |       | projectId (FK)    |       | name           |
| displayName    |       | userId (FK)       |       | description    |
| email          |<----->| role              |<----->| status         |
| avatar         |  1:N  | joinedAt          |  1:N  | color          |
| role           |       |                   |       | createdAt      |
| createdAt      |       |                   |       | updatedAt      |
| lastLogin      |       |                   |       |                |
+----------------+       +-------------------+       +----------------+
        ^                                                   |
        |                                                   |
        | 1:N                                               | 1:N
        |                                                   |
        |                                                   v
+----------------+                               +-------------------+
|     TASKS      |                               |   TASK_UPDATES    |
+----------------+                               +-------------------+
| id (PK)        |                               | id (PK)           |
| projectId (FK) |                               | taskId (FK)       |
| title          |                               | userId (FK)       |
| description    |<------------------------------>| content          |
| status         |              1:N              | type             |
| priority       |                               | timestamp        |
| dueDate        |                               | attachments      |
| category       |                               |                   |
| assigneeId (FK)|                               |                   |
| reporterId (FK)|                               |                   |
| createdAt      |                               |                   |
| updatedAt      |                               |                   |
| completed      |                               |                   |
+----------------+                               +-------------------+
```

The diagram above illustrates the relationships between our five main MongoDB collections:

- **Users to Project_Members**: One-to-Many (1:N) - A user can be a member of multiple projects
- **Projects to Project_Members**: One-to-Many (1:N) - A project can have multiple members
- **Projects to Tasks**: One-to-Many (1:N) - A project can contain multiple tasks
- **Users to Tasks**: One-to-Many (1:N) - A user can be assigned to or report multiple tasks
- **Tasks to Task_Updates**: One-to-Many (1:N) - A task can have multiple updates

## Optimized Data Model

### Project Document
```json
{
  "_id": "project123",
  "name": "AWS Starter Project",
  "members": [
    {
      "userId": "user456",
      "name": "John Doe",
      "role": "Member"
    }
  ]
}
```

### Task Document
```json
{
  "_id": "task789",
  "projectId": "project123",
  "assigneeId": "user456",
  "title": "Implement MongoDB optimizations",
  "updates": [
    {
      "content": "Started implementation",
      "timestamp": "2025-03-15T09:20:00Z",
      "user": {
        "id": "user789",
        "name": "John Doe"
      }
    }
  ]
}
```

### User Document
```json
{
  "_id": "user456",
  "name": "John Doe",
  "projects": [
    {
      "projectId": "project123",
      "name": "AWS Starter Project",
      "role": "Member"
    }
  ]
}
```

## 1. User Entity

The `UserEntity` represents users in the system who can create projects, be assigned to tasks, and collaborate with team members.

### Schema Definition

```java
@Document(collection = "users")
public class UserEntity {
    @Id
    private String id;
    private String username;
    private String displayName;
    private String email;
    private String avatar;
    private String role;
    private LocalDateTime createdAt;
    private LocalDateTime lastLogin;
    
    // Constructors, getters, and setters...
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| id | String | Unique identifier for the user, automatically generated by MongoDB |
| username | String | Unique username for login and identification |
| displayName | String | Full name or display name of the user |
| email | String | Email address of the user |
| avatar | String | URL to the user's profile image |
| role | String | System role of the user (e.g., "Admin", "Member") |
| createdAt | LocalDateTime | Timestamp when the user account was created |
| lastLogin | LocalDateTime | Timestamp of the user's last login |

## 2. Project Entity

The `ProjectEntity` represents projects that organize tasks and team members.

### Schema Definition

```java
@Document(collection = "projects")
public class ProjectEntity {
    @Id
    private String id;
    private String name;
    private String description;
    private String status; // "Active", "Completed", "Archived"
    private String color; // Color code for visual identification
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // Constructors, getters, and setters...
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| id | String | Unique identifier for the project, automatically generated by MongoDB |
| name | String | Name of the project |
| description | String | Detailed description of the project |
| status | String | Current status of the project: "Active", "Completed", or "Archived" |
| color | String | Color code for visual identification of the project |
| createdAt | LocalDateTime | Timestamp when the project was created |
| updatedAt | LocalDateTime | Timestamp when the project was last updated |

## 3. Project Member Entity

The `ProjectMemberEntity` manages the many-to-many relationship between projects and users, including role information.

### Schema Definition

```java
@Document(collection = "project_members")
public class ProjectMemberEntity {
    @Id
    private String id;
    private String projectId;
    private String userId;
    private String role; // "Owner", "Member", "Viewer"
    private LocalDateTime joinedAt;
    
    // Constructors, getters, and setters...
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| id | String | Unique identifier, automatically generated by MongoDB |
| projectId | String | Reference to the project |
| userId | String | Reference to the user |
| role | String | Role of the user in the project: "Owner", "Member", or "Viewer" |
| joinedAt | LocalDateTime | Timestamp when the user joined the project |

## 4. Task Entity

The `TaskEntity` represents individual tasks with their properties, project association, and user assignments.

### Schema Definition

```java
@Document(collection = "tasks")
public class TaskEntity {
    @Id
    private String id;
    private String projectId; // Reference to the project
    private String title;
    private String description;
    private String status; // "TODO", "IN_PROGRESS", "DONE"
    private String priority; // "HIGH", "MEDIUM", "LOW"
    private LocalDateTime dueDate;
    private String category;
    private String assigneeId; // User assigned to the task
    private String reporterId; // User who created the task
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private boolean completed;
    
    // Constructors, getters, and setters...
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| id | String | Unique identifier for the task, automatically generated by MongoDB |
| projectId | String | Reference to the project this task belongs to |
| title | String | Short title or name of the task |
| description | String | Detailed description of the task |
| status | String | Current status of the task: "TODO", "IN_PROGRESS", or "DONE" |
| priority | String | Priority level: "HIGH", "MEDIUM", or "LOW" |
| dueDate | LocalDateTime | Date and time when the task is due |
| category | String | Category for organizing tasks (e.g., "Development", "Documentation") |
| assigneeId | String | Reference to the user assigned to the task |
| reporterId | String | Reference to the user who created the task |
| createdAt | LocalDateTime | Timestamp when the task was created |
| updatedAt | LocalDateTime | Timestamp when the task was last updated |
| completed | boolean | Flag indicating whether the task is completed |

### Task Status Values

The `status` field in the Task entity can have the following values:

- **TODO**: Task has not been started
- **IN_PROGRESS**: Task is currently being worked on
- **DONE**: Task has been completed

### Task Priority Levels

The `priority` field in the Task entity can have the following values:

- **HIGH**: Urgent tasks that require immediate attention
- **MEDIUM**: Important tasks but not urgent
- **LOW**: Tasks that can be addressed when time permits

### Project Status Values

The `status` field in the Project entity can have the following values:

- **Active**: Project is currently in progress
- **Completed**: Project has been finished successfully
- **Archived**: Project is no longer active but preserved for reference

### Project Member Roles

The `role` field in the ProjectMember entity can have the following values:

- **Owner**: Has full control over the project, including deletion
- **Member**: Can create and modify tasks, add comments
- **Viewer**: Can only view project content, cannot make changes

## 5. Task Update Entity

The `TaskUpdateEntity` stores progress updates, comments, and status changes for tasks.

### Schema Definition

```java
@Document(collection = "task_updates")
public class TaskUpdateEntity {
    @Id
    private String id;
    private String taskId; // Reference to the task
    private String userId; // Reference to the user who made the update
    private String content; // Text content of the update
    private String type; // "Comment", "Status Change", "Progress Update"
    private LocalDateTime timestamp;
    private List<String> attachments; // URLs to attached files
    
    // Constructors, getters, and setters...
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| id | String | Unique identifier, automatically generated by MongoDB |
| taskId | String | Reference to the task this update belongs to |
| userId | String | Reference to the user who made the update |
| content | String | Text content of the update or comment |
| type | String | Type of update: "Comment", "Status Change", or "Progress Update" |
| timestamp | LocalDateTime | When the update was created |
| attachments | List<String> | List of URLs to attached files |

## Data Relationships

The project management system uses a document-based data model with references between collections to establish relationships:

### 1. Projects to Tasks (One-to-Many)
- Each task belongs to exactly one project
- A project can have multiple tasks
- Implemented via the `projectId` field in the `tasks` collection

### 2. Users to Tasks (Many-to-Many)
- A user can be assigned to multiple tasks (via `assigneeId`)
- A user can report/create multiple tasks (via `reporterId`)
- A task has exactly one assignee and one reporter

### 3. Projects to Users (Many-to-Many)
- A user can be a member of multiple projects
- A project can have multiple user members
- Implemented via the `project_members` collection

### 4. Tasks to Updates (One-to-Many)
- Each task update belongs to exactly one task
- A task can have multiple updates
- Implemented via the `taskId` field in the `task_updates` collection

## Data Validation

While MongoDB does not enforce schema validation by default, the application implements validation at multiple levels:

### API Level Validation
- Required fields validation
- Data type checking
- Business rule enforcement

### MongoDB Schema Validation
- JSON Schema validation rules defined for each collection
- Enforces document structure and field types
- Prevents invalid documents from being inserted

### Default Values and Automatic Fields
- Status defaults: tasks default to "TODO", projects default to "Active"
- Priority defaults: tasks default to "MEDIUM"
- Automatic timestamps: createdAt and updatedAt are managed automatically

## MongoDB Collections

The project management system uses the following MongoDB collections:

| Collection Name | Purpose | Entity Class |
|-----------------|---------|-------------|
| users | Stores user information | UserEntity |
| projects | Stores project details | ProjectEntity |
| project_members | Manages project-user relationships with roles | ProjectMemberEntity |
| tasks | Stores task information with project and user references | TaskEntity |
| task_updates | Stores progress updates, comments, and status changes | TaskUpdateEntity |

## MongoDB Indexes

To optimize query performance, the following indexes are defined:

| Collection | Index Fields | Purpose |
|------------|--------------|----------|
| tasks | projectId | Fast lookup of tasks by project |
| tasks | assigneeId | Fast lookup of tasks by assignee |
| task_updates | taskId | Fast lookup of updates by task |
| project_members | projectId, userId | Fast lookup of project membership |

## Best Practices for Working with the Data Model

1. **Use Repository Methods**: Leverage the provided repository methods for querying and manipulating data
2. **Validate Input**: Always validate input data before saving to the database
3. **Handle Dates Properly**: Use appropriate date formatting and time zone handling
4. **Update Timestamps**: Ensure updatedAt is set whenever entities are modified
5. **Status Consistency**: Maintain consistency between status fields and related flags
6. **Reference Integrity**: Ensure referenced IDs exist before creating relationships
7. **Batch Operations**: Use bulk operations for better performance when processing multiple documents
8. **Pagination**: Implement pagination for endpoints that return potentially large result sets
9. **Projection**: Use field projection to limit the data returned by queries when only specific fields are needed
